<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel to JSON Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .file-input-wrapper {
            position: relative;
            margin-bottom: 30px;
        }

        .file-input-label {
            display: block;
            padding: 20px;
            border: 3px dashed #667eea;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .file-input-label:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }

        .file-input-label.dragover {
            background: #e8ebff;
            border-color: #764ba2;
        }

        input[type="file"] {
            display: none;
        }

        .file-name {
            margin-top: 10px;
            color: #667eea;
            font-weight: 600;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .download-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            display: none;
        }

        .download-btn:hover {
            box-shadow: 0 10px 20px rgba(17, 153, 142, 0.4);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .preview {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .preview.show {
            display: block;
        }

        .preview pre {
            font-size: 12px;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .info {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-size: 14px;
            color: #004085;
        }

        .info strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Excel to JSON Converter</h1>
        <p class="subtitle">Convert Excel files to structured JSON format</p>

        <div class="info">
            <strong>Instructions:</strong>
            <ul style="margin-left: 20px; margin-top: 5px;">
                <li>Column 1: Customer Name</li>
                <li>Column 2: Product (ABPP, BATM, or CATMAN)</li>
                <li>Column 3: URL Link</li>
            </ul>
        </div>

        <div class="file-input-wrapper">
            <label for="excelFile" class="file-input-label" id="fileLabel">
                <div>üìÅ Click to select Excel file or drag and drop</div>
                <div class="file-name" id="fileName"></div>
            </label>
            <input type="file" id="excelFile" accept=".xlsx,.xls" />
        </div>

        <button class="btn" id="convertBtn" disabled>Convert to JSON</button>
        <button class="btn download-btn" id="downloadBtn">Download JSON File</button>

        <div class="status" id="status"></div>
        <div class="preview" id="preview"></div>
    </div>

    <script>
        const excelFileInput = document.getElementById('excelFile');
        const fileLabel = document.getElementById('fileLabel');
        const fileName = document.getElementById('fileName');
        const convertBtn = document.getElementById('convertBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const status = document.getElementById('status');
        const preview = document.getElementById('preview');
        
        let jsonData = null;

        // File input change handler
        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                fileName.textContent = `Selected: ${file.name}`;
                convertBtn.disabled = false;
                status.className = 'status';
                preview.className = 'preview';
                downloadBtn.style.display = 'none';
            }
        });

        // Drag and drop handlers
        fileLabel.addEventListener('dragover', function(e) {
            e.preventDefault();
            fileLabel.classList.add('dragover');
        });

        fileLabel.addEventListener('dragleave', function(e) {
            e.preventDefault();
            fileLabel.classList.remove('dragover');
        });

        fileLabel.addEventListener('drop', function(e) {
            e.preventDefault();
            fileLabel.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0 && (files[0].name.endsWith('.xlsx') || files[0].name.endsWith('.xls'))) {
                excelFileInput.files = files;
                fileName.textContent = `Selected: ${files[0].name}`;
                convertBtn.disabled = false;
                status.className = 'status';
                preview.className = 'preview';
                downloadBtn.style.display = 'none';
            }
        });

        // Convert button handler
        convertBtn.addEventListener('click', function() {
            const file = excelFileInput.files[0];
            if (!file) {
                showStatus('Please select an Excel file first.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Read only the first sheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert to JSON (array of arrays)
                    const jsonDataArray = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                    
                    // Process the data
                    jsonData = processExcelData(jsonDataArray);
                    
                    // Display preview
                    preview.innerHTML = '<pre>' + JSON.stringify(jsonData, null, 2) + '</pre>';
                    preview.classList.add('show');
                    
                    // Show download button
                    downloadBtn.style.display = 'block';
                    
                    // Show success message
                    showStatus('Conversion successful! You can now download the JSON file.', 'success');
                } catch (error) {
                    showStatus('Error reading Excel file: ' + error.message, 'error');
                    console.error(error);
                }
            };
            
            reader.onerror = function() {
                showStatus('Error reading file.', 'error');
            };
            
            reader.readAsArrayBuffer(file);
        });

        // Download button handler
        downloadBtn.addEventListener('click', function() {
            if (!jsonData) {
                showStatus('No JSON data to download.', 'error');
                return;
            }

            const jsonString = JSON.stringify(jsonData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'output.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('JSON file downloaded successfully!', 'success');
        });

        function processExcelData(dataArray) {
            // Skip header row if present (optional - we'll check if first row looks like headers)
            let startRow = 0;
            if (dataArray.length > 0) {
                // Check if first row might be headers (contains common header words)
                const firstRow = dataArray[0].map(cell => String(cell).toLowerCase());
                if (firstRow.some(cell => 
                    cell.includes('customer') || 
                    cell.includes('product') || 
                    cell.includes('url') ||
                    cell.includes('link')
                )) {
                    startRow = 1;
                }
            }

            // Group data by customer and product
            const customerMap = {};

            for (let i = startRow; i < dataArray.length; i++) {
                const row = dataArray[i];
                
                // Skip empty rows
                if (!row || row.length === 0 || !row[0]) {
                    continue;
                }

                const customer = String(row[0] || '').trim();
                const product = String(row[1] || '').trim().toUpperCase();
                const url = String(row[2] || '').trim();

                // Skip if essential data is missing
                if (!customer || !product || !url) {
                    continue;
                }

                // Initialize customer if not exists
                if (!customerMap[customer]) {
                    customerMap[customer] = {
                        Customer: customer,
                        Deployment: "Cloud"
                    };
                }

                // Initialize product array if not exists
                if (!customerMap[customer][product]) {
                    customerMap[customer][product] = [];
                }

                // Add URL entry
                const urlEntry = {
                    url: url,
                    branch: "main"
                };

                // Add verified: true for ABPP products
                if (product === "ABPP") {
                    urlEntry.verified = true;
                }

                customerMap[customer][product].push(urlEntry);
            }

            // Convert map to array
            return Object.values(customerMap);
        }

        function showStatus(message, type) {
            status.textContent = message;
            status.className = 'status ' + type;
        }
    </script>
</body>
</html>

